import{j as e}from"./index-COPZ4fKZ.js";import{r as t}from"./vendor-react-9fiDQRhm.js";import{X as s,S as o}from"./vendor-icons-C8WoZG9s.js";const a="https://auto.juxtarank.com/webhook/chatbot";function r(){const[r,l]=t.useState(!1),[n,i]=t.useState([]),[c,d]=t.useState(""),[m,h]=t.useState(!1),[u]=t.useState(()=>`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),[b,f]=t.useState(!1),[g,p]=t.useState(!0),w=t.useRef(null),x=t.useRef(null);t.useEffect(()=>{if(!localStorage.getItem("chatbot_visited")&&!b){const e=setTimeout(()=>{l(!0),f(!0),localStorage.setItem("chatbot_visited","true");const e={id:`msg_${Date.now()}`,sessionId:u,message:"Hello! I'm Antek AI. How can I help you automate your business today?",timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};i([e])},5e3);return()=>clearTimeout(e)}},[b,u]),t.useEffect(()=>{const e=()=>{if(l(!0),0===n.length){const e={id:`msg_${Date.now()}`,sessionId:u,message:"Hello! I'm Antek AI. How can I help you automate your business today?",timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};i([e])}};return window.addEventListener("openChatbot",e),()=>window.removeEventListener("openChatbot",e)},[u,n.length]),t.useEffect(()=>{var e;null==(e=w.current)||e.scrollIntoView({behavior:"smooth"})},[n]),t.useEffect(()=>{if(r)return void p(!1);const e=setInterval(()=>{p(e=>!e)},3500);return p(!0),()=>clearInterval(e)},[r]),t.useEffect(()=>{var e;r&&!m&&(null==(e=x.current)||e.focus())},[r,m]);return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(!r),className:"fixed bottom-6 right-6 w-15 h-15 bg-terracotta border-3 border-charcoal shadow-brutal-sm rounded-sm flex items-center justify-center hover:-translate-x-[2px] hover:-translate-y-[2px] hover:shadow-brutal transition-all duration-200 z-50 "+(g&&!r?"animate-jitter-pulse":""),"aria-label":"Open chat",children:r?e.jsx(s,{className:"w-7 h-7 text-off-white"}):e.jsx("span",{className:"text-2xl font-black text-off-white",children:"C"})}),r&&e.jsxs("div",{className:"fixed bottom-24 left-4 right-4 md:bottom-24 md:right-6 md:left-auto w-auto md:w-[400px] max-h-[calc(100vh-150px)] md:h-[600px] bg-off-white border-3 border-charcoal shadow-brutal-chat flex flex-col z-50",children:[e.jsx("div",{className:"bg-warm-beige border-b-3 border-charcoal p-4 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-xl uppercase",children:"Antek AI"}),e.jsx("p",{className:"text-xs text-charcoal",children:"Always here to help"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-off-white",children:[n.map(t=>e.jsx("div",{className:"flex "+(t.isBot?"justify-start":"justify-end"),children:e.jsx("div",{className:`max-w-[70%] ${t.isBot?"bg-white border-2 border-charcoal shadow-brutal-msg":"bg-warm-beige border-2 border-charcoal shadow-brutal-msg"} p-3 rounded-sm`,children:e.jsx("p",{className:"text-charcoal text-sm leading-normal",children:t.message})})},t.id)),m&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white border-2 border-charcoal shadow-brutal-msg p-3 rounded-sm",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})}),e.jsx("div",{ref:w})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!c.trim()||m)return;const t={id:`msg_${Date.now()}`,sessionId:u,message:c,timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!1};i(e=>[...e,t]),d(""),h(!0);try{if(a){console.log("Sending to webhook:",a),console.log("Payload:",{sessionId:t.sessionId,message:t.message,timestamp:t.timestamp,pageUrl:t.pageUrl,source:t.source});const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t.sessionId,message:t.message,timestamp:t.timestamp,pageUrl:t.pageUrl,source:t.source})});if(console.log("Response status:",e.status),console.log("Response ok:",e.ok),!e.ok)throw console.error("Webhook failed with status:",e.status),new Error("Webhook failed");{const t=await e.text();let o;console.log("Raw response text:",t);try{o=JSON.parse(t),console.log("Parsed response data:",o),Array.isArray(o)&&o.length>0&&(o=o[0],console.log("Extracted first item from array:",o))}catch(s){console.error("JSON parse error:",s),console.log("Response was not valid JSON, using as plain text"),o={output:t}}const a={id:`msg_${Date.now()}`,sessionId:u,message:o.output||o.reply||"Thanks for your message! We'll get back to you shortly.",timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};i(e=>[...e,a])}}}catch(o){console.error("Chatbot error:",o);const e={id:`msg_${Date.now()}`,sessionId:u,message:"Connection error. Please try again or email us at hello@antekautomation.com",timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};i(t=>[...t,e])}finally{h(!1)}},className:"border-t-3 border-charcoal p-4 flex gap-2 bg-off-white",children:[e.jsx("input",{ref:x,type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Type message...",className:"flex-1 border-3 border-charcoal px-3 py-2 focus:border-terracotta focus:outline-none bg-white text-charcoal",disabled:m}),e.jsx("button",{type:"submit",disabled:m||!c.trim(),className:"bg-terracotta text-off-white px-4 py-2 border-3 border-charcoal shadow-brutal-xs font-black hover:-translate-x-[1px] hover:-translate-y-[1px] hover:shadow-brutal-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(o,{className:"w-5 h-5"})})]})]})]})}export{r as ChatbotWidget};
//# sourceMappingURL=ChatbotWidget-DsuF_dNm.js.map
