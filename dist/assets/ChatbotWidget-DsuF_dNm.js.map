{"version":3,"file":"ChatbotWidget-DsuF_dNm.js","sources":["../../src/components/ChatbotWidget.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { X, Send } from 'lucide-react';\nimport { ChatMessage } from '../types';\n\nconst CHATBOT_WEBHOOK_URL = import.meta.env.VITE_CHATBOT_WEBHOOK_URL || '';\n\nexport function ChatbotWidget() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [sessionId] = useState(() => `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);\n  const [hasAutoOpened, setHasAutoOpened] = useState(false);\n  const [showAnimation, setShowAnimation] = useState(true);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    const hasVisited = localStorage.getItem('chatbot_visited');\n    if (!hasVisited && !hasAutoOpened) {\n      const timer = setTimeout(() => {\n        setIsOpen(true);\n        setHasAutoOpened(true);\n        localStorage.setItem('chatbot_visited', 'true');\n\n        const welcomeMessage: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: \"Hello! I'm Antek AI. How can I help you automate your business today?\",\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: 'website_chatbot',\n          isBot: true,\n        };\n        setMessages([welcomeMessage]);\n      }, 5000);\n\n      return () => clearTimeout(timer);\n    }\n  }, [hasAutoOpened, sessionId]);\n\n  // Listen for custom event to open chatbot\n  useEffect(() => {\n    const handleOpenChatbot = () => {\n      setIsOpen(true);\n      if (messages.length === 0) {\n        const welcomeMessage: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: \"Hello! I'm Antek AI. How can I help you automate your business today?\",\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: 'website_chatbot',\n          isBot: true,\n        };\n        setMessages([welcomeMessage]);\n      }\n    };\n\n    window.addEventListener('openChatbot', handleOpenChatbot);\n    return () => window.removeEventListener('openChatbot', handleOpenChatbot);\n  }, [sessionId, messages.length]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  // Animation on/off cycle for attention-grabbing effect\n  useEffect(() => {\n    if (isOpen) {\n      setShowAnimation(false);\n      return;\n    }\n\n    // Show animation for 3 seconds, then hide for 4 seconds, repeat\n    const animationInterval = setInterval(() => {\n      setShowAnimation((prev) => !prev);\n    }, 3500);\n\n    // Start with animation showing\n    setShowAnimation(true);\n\n    return () => clearInterval(animationInterval);\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (isOpen && !isLoading) {\n      inputRef.current?.focus();\n    }\n  }, [isOpen, isLoading]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!inputMessage.trim() || isLoading) return;\n\n    const userMessage: ChatMessage = {\n      id: `msg_${Date.now()}`,\n      sessionId,\n      message: inputMessage,\n      timestamp: new Date().toISOString(),\n      pageUrl: window.location.href,\n      source: 'website_chatbot',\n      isBot: false,\n    };\n\n    setMessages((prev) => [...prev, userMessage]);\n    setInputMessage('');\n    setIsLoading(true);\n\n    try {\n      if (CHATBOT_WEBHOOK_URL) {\n        console.log('Sending to webhook:', CHATBOT_WEBHOOK_URL);\n        console.log('Payload:', {\n          sessionId: userMessage.sessionId,\n          message: userMessage.message,\n          timestamp: userMessage.timestamp,\n          pageUrl: userMessage.pageUrl,\n          source: userMessage.source,\n        });\n\n        const response = await fetch(CHATBOT_WEBHOOK_URL, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            sessionId: userMessage.sessionId,\n            message: userMessage.message,\n            timestamp: userMessage.timestamp,\n            pageUrl: userMessage.pageUrl,\n            source: userMessage.source,\n          }),\n        });\n\n        console.log('Response status:', response.status);\n        console.log('Response ok:', response.ok);\n\n        if (response.ok) {\n          const responseText = await response.text();\n          console.log('Raw response text:', responseText);\n\n          let data;\n          try {\n            data = JSON.parse(responseText);\n            console.log('Parsed response data:', data);\n\n            // Handle array response format from n8n\n            if (Array.isArray(data) && data.length > 0) {\n              data = data[0];\n              console.log('Extracted first item from array:', data);\n            }\n          } catch (parseError) {\n            console.error('JSON parse error:', parseError);\n            console.log('Response was not valid JSON, using as plain text');\n            data = { output: responseText };\n          }\n\n          const botReply: ChatMessage = {\n            id: `msg_${Date.now()}`,\n            sessionId,\n            message: data.output || data.reply || \"Thanks for your message! We'll get back to you shortly.\",\n            timestamp: new Date().toISOString(),\n            pageUrl: window.location.href,\n            source: 'website_chatbot',\n            isBot: true,\n          };\n          setMessages((prev) => [...prev, botReply]);\n        } else {\n          console.error('Webhook failed with status:', response.status);\n          throw new Error('Webhook failed');\n        }\n      } else {\n        console.log('No webhook URL configured');\n        const botReply: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: \"Thanks for reaching out! Our team will respond soon. You can also email us at hello@antekautomation.com\",\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: 'website_chatbot',\n          isBot: true,\n        };\n        setMessages((prev) => [...prev, botReply]);\n      }\n    } catch (error) {\n      console.error('Chatbot error:', error);\n      const errorMessage: ChatMessage = {\n        id: `msg_${Date.now()}`,\n        sessionId,\n        message: \"Connection error. Please try again or email us at hello@antekautomation.com\",\n        timestamp: new Date().toISOString(),\n        pageUrl: window.location.href,\n        source: 'website_chatbot',\n        isBot: true,\n      };\n      setMessages((prev) => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`fixed bottom-6 right-6 w-15 h-15 bg-terracotta border-3 border-charcoal shadow-brutal-sm rounded-sm flex items-center justify-center hover:-translate-x-[2px] hover:-translate-y-[2px] hover:shadow-brutal transition-all duration-200 z-50 ${\n          showAnimation && !isOpen ? 'animate-jitter-pulse' : ''\n        }`}\n        aria-label=\"Open chat\"\n      >\n        {isOpen ? (\n          <X className=\"w-7 h-7 text-off-white\" />\n        ) : (\n          <span className=\"text-2xl font-black text-off-white\">C</span>\n        )}\n      </button>\n\n      {isOpen && (\n        <div className=\"fixed bottom-24 left-4 right-4 md:bottom-24 md:right-6 md:left-auto w-auto md:w-[400px] max-h-[calc(100vh-150px)] md:h-[600px] bg-off-white border-3 border-charcoal shadow-brutal-chat flex flex-col z-50\">\n          <div className=\"bg-warm-beige border-b-3 border-charcoal p-4 flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-black text-xl uppercase\">Antek AI</h3>\n              <p className=\"text-xs text-charcoal\">Always here to help</p>\n            </div>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-off-white\">\n            {messages.map((msg) => (\n              <div\n                key={msg.id}\n                className={`flex ${msg.isBot ? 'justify-start' : 'justify-end'}`}\n              >\n                <div\n                  className={`max-w-[70%] ${\n                    msg.isBot\n                      ? 'bg-white border-2 border-charcoal shadow-brutal-msg'\n                      : 'bg-warm-beige border-2 border-charcoal shadow-brutal-msg'\n                  } p-3 rounded-sm`}\n                >\n                  <p className=\"text-charcoal text-sm leading-normal\">{msg.message}</p>\n                </div>\n              </div>\n            ))}\n            {isLoading && (\n              <div className=\"flex justify-start\">\n                <div className=\"bg-white border-2 border-charcoal shadow-brutal-msg p-3 rounded-sm\">\n                  <div className=\"flex space-x-2\">\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.4s' }}></div>\n                  </div>\n                </div>\n              </div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"border-t-3 border-charcoal p-4 flex gap-2 bg-off-white\">\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={inputMessage}\n              onChange={(e) => setInputMessage(e.target.value)}\n              placeholder=\"Type message...\"\n              className=\"flex-1 border-3 border-charcoal px-3 py-2 focus:border-terracotta focus:outline-none bg-white text-charcoal\"\n              disabled={isLoading}\n            />\n            <button\n              type=\"submit\"\n              disabled={isLoading || !inputMessage.trim()}\n              className=\"bg-terracotta text-off-white px-4 py-2 border-3 border-charcoal shadow-brutal-xs font-black hover:-translate-x-[1px] hover:-translate-y-[1px] hover:shadow-brutal-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <Send className=\"w-5 h-5\" />\n            </button>\n          </form>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":["CHATBOT_WEBHOOK_URL","ChatbotWidget","isOpen","setIsOpen","useState","messages","setMessages","inputMessage","setInputMessage","isLoading","setIsLoading","sessionId","Date","now","Math","random","toString","substr","hasAutoOpened","setHasAutoOpened","showAnimation","setShowAnimation","messagesEndRef","useRef","inputRef","useEffect","localStorage","getItem","timer","setTimeout","setItem","welcomeMessage","id","message","timestamp","toISOString","pageUrl","window","location","href","source","isBot","clearTimeout","handleOpenChatbot","length","addEventListener","removeEventListener","_a","current","scrollIntoView","behavior","animationInterval","setInterval","prev","clearInterval","focus","jsxRuntimeExports","jsxs","Fragment","children","jsx","onClick","className","X","map","msg","style","animationDelay","ref","onSubmit","async","e","preventDefault","trim","userMessage","console","log","response","fetch","method","headers","body","JSON","stringify","status","ok","error","Error","responseText","text","data","parse","Array","isArray","parseError","output","botReply","reply","errorMessage","type","value","onChange","target","placeholder","disabled","Send"],"mappings":"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"}